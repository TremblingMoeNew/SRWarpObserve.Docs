# 内部储存格式 - STARWO格式

星穹铁道跃迁观测工具记录保存格式，简称STARWO格式，是本工具用于保存用户跃迁历史记录的内部格式。

本工具未使用数据库保存用户数据，而是以STARWO格式将用户数据保存在`userdata/userlog_{UID}.json`文件中。将对应文件放到正确位置即可完成数据的迁移，但由于当前版本中并无用户切换功能，建议您使用导出与导入功能进行迁移。

## 格式介绍

当前的STARWO格式版本为`V1`。其基本信息直接保存于根对象之下，而跃迁记录项保存在名为`LogsV1`的列表中。

### 根对象

根对象下包含以下字段：

| 字段 | 含义 | 
| ---- | ---- | 
| `UID` | 用户的《崩坏：星穹铁道》游戏UID |
| `TimeZone` | 用户所在服务器的时区，为介于-11与11间的整数，与官方API及SRGF中的`region_time_zone`等价 |
| `ClientType` | 用户所属客户端类型，枚举类型，定义见下文 |
| `LogsV1` | 符合`V1`版本定义的跃迁记录项列表；防止出现无法处理的中断性更改 |

其中，`ClientType`的定义如下：
| 枚举项 | 值 | 含义 |
| ---- | ---- | --- |
| `Unknown`| `0` | 未知客户端；不应在记录文件中出现 |
| `CN` | `1` | 国服客户端 |
| `Global` | `2`| 国际服客户端 |

### 跃迁记录项

跃迁记录项中的字段可被分为记录项信息、内部索引信息与保留原始信息三类。

#### 记录项信息

该部分字段为从米哈游跃迁记录API或导入文件中获取的，经过本工具格式转换与重命名的，并使用到的信息。

该部分包括以下字段：

| 字段 | 对应原始字段 | 含义 | 
| ---- | ----------- | --- |
| `ID` | `id` | 跃迁记录项的编号 |
| `Name` | `name` | 该次跃迁获得的单位的名称 |
| `Time` | `time` | 该次跃迁的服务器时间，不进行时区转换 |
| `PoolType` | | 获取该跃迁记录项时在官方API中使用的跃迁类型编号<br/>枚举，与`gacha_type`不完全等价，定义见下文|
| `Rank` | `rank_type` | 该次跃迁获得的单位的星级 |
| `UnitType` | `item_type` | 该次跃迁获得的单位的类型，枚举，定义见下文|

其中，`PoolType`的定义如下：
| 枚举项 | 值 | 含义 |
| ---- | ---- | --- |
| `Permanent` | `1` | 常驻跃迁 |
| `Beginner` | `2` | 新手跃迁 |
| `CharacterEvent` | `11` | 角色活动跃迁(及未来可能出现的其它与其共享计数器的类型) |
| `LCEvent` | `12` | 光锥活动跃迁(及未来可能出现的其它与其共享计数器的类型) |

`UnitType`的定义如下：
| 枚举项 | 值 | 含义 |
| ---- | ---- | --- |
| `Unknown` | `0` | 未知类型，不应出现 |
| `Character` | `1` | 角色 |
| `LightCone` | `2` | 光锥 |

#### 内部索引信息

本工具按照版本-卡池-轮次三级层次对数据进行整理与展示，在跃迁记录项中添加了以下字段以方便查找归类。

| 字段 |  含义 | 
| ----| ------|
| `VersionID` | 跃迁记录项所属版本ID。版本ID在卡池数据库中规定。 |
| `BannerID` | 跃迁记录所属版本ID与卡池ID组合成的内部卡池ID。版本ID与卡池ID在卡池数据库中规定。 |
| `RoundID` | 跃迁记录所属的基础轮次的ID，即本基础轮次中第一个跃迁记录项的ID。 |

按照抽取到五星单位的跃迁记录项，本工具按照时间顺序对跃迁记录进行切分并称每一个分段为一个基础轮次。抽取到五星单位的跃迁记录项必定为其所在基础轮次的最后一个记录项。一个基础轮次可以大体认为与一般所称的“一个小保底”基本相同。

#### 保留原始信息

本工具保留了一些原始跃迁记录项中包含的、但当前并未被本工具实际使用到的字段。

| 字段 |  含义 | 
| ----| ------|
| `Raw` | 保留原始信息对象 | 

`Raw`字段为一个对象，其下包含以下字段：

| 字段 | 含义|
| ----| ------|
| `gacha_id` | 该跃迁记录所属卡池的官方编号 |
| `gacha_type` | 该跃迁记录所属的类型；与`PoolType`不保证一定相同 |
| `item_id` | 该次跃迁获得的单位的官方编号 |
| `count` | 数量，当前固定为`"1"`|